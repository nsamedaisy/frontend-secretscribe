<!DOCTYPE html>
<html>
<head>
  <title>Real-time Message Notifications</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.3.1/socket.io.js"></script>
  <script>
    // Connect to the Socket.IO server
    const socket = io();

    // Handle form submission
    function sendMessage() {
      const input = document.getElementById('messageInput');
      const message = input.value;

      // Emit the new message event
      socket.emit('newMessage', message);

      input.value = '';
    }

    // Handle message received event
    socket.on('messageReceived', (message) => {
      const messagesList = document.getElementById('messagesList');
      const li = document.createElement('li');
      li.textContent = message;
      messagesList.appendChild(li);
    });

    // Handle login form submission
    function login() {
      const username = document.getElementById('username').value;
      const password = document.getElementById('password').value;

      fetch('/login', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ username, password })
      })
      .then(response => response.json())
      .then(data => {
        // Save the JWT token to localStorage
        localStorage.setItem('token', data.token);
        // Show the chat interface
        showChatInterface();
      })
      .catch(error => console.error(error));
    }

    // Handle logout
    function logout() {
      // Remove the JWT token from localStorage
      localStorage.removeItem('token');
      // Hide thechat interface
      hideChatInterface();
    }

    // Show the chat interface
    function showChatInterface() {
      document.getElementById('loginForm').style.display = 'none';
      document.getElementById('chatInterface').style.display = 'block';
    }

    // Hide the chat interface
    function hideChatInterface() {
      document.getElementById('loginForm').style.display = 'block';
      document.getElementById('chatInterface').style.display = 'none';
    }

    // Check if the user is already logged in
    const token = localStorage.getItem('token');
    if (token) {
      // Fetch user profile
      fetch('/profile', {
        headers: { 'Authorization': token }
      })
      .then(response => response.json())
      .then(data => {
        // Show the chat interface
        showChatInterface();
      })
      .catch(error => {
        // Invalid or expired token, show the login form
        hideChatInterface();
        console.error(error);
      });
    } else {
      // Hide the chat interface
      hideChatInterface();
    }
  </script>
</head>
<body>
  <h1>Real-time Message Notifications</h1>

  <div id="loginForm">
    <h2>Login</h2>
    <form onsubmit="event.preventDefault(); login()">
      <input type="text" id="username" placeholder="Username" required><br>
      <input type="password" id="password" placeholder="Password" required><br>
      <button type="submit">Login</button>
    </form>
  </div>

  <div id="chatInterface" style="display:none;">
    <h2>Chat</h2>

    <ul id="messagesList"></ul>

    <form onsubmit="event.preventDefault(); sendMessage()">
      <input type="text" id="messageInput" placeholder="Type a message" required>
      <button type="submit">Send</button>
    </form>

    <button onclick="logout()">Logout</button>
  </div>
</body>
</html>